<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PWA Test - Tribly Admin</title>
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#f6f6f6">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f6f6f6;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
        .icon {
            width: 64px;
            height: 64px;
            margin: 20px auto;
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <img src="/icons/icon-192x192.png" alt="Tribly Admin" class="icon">
        <h1>PWA Test - Tribly Admin Dashboard</h1>
        
        <div id="status"></div>
        
        <h2>PWA Features Test</h2>
        <ul>
            <li id="manifest-test">Manifest: <span id="manifest-status">Testing...</span></li>
            <li id="sw-test">Service Worker: <span id="sw-status">Testing...</span></li>
            <li id="install-test">Install Prompt: <span id="install-status">Testing...</span></li>
            <li id="offline-test">Offline Support: <span id="offline-status">Testing...</span></li>
        </ul>
        
        <h2>Status Bar Color</h2>
        <p>The status bar should be colored <strong>#f6f6f6</strong> when the app is installed.</p>
        
        <h2>Installation</h2>
        <p>To install this PWA:</p>
        <ul>
            <li><strong>Chrome/Edge:</strong> Look for the install button in the address bar</li>
            <li><strong>Mobile Chrome:</strong> Tap the menu (three dots) → "Add to Home screen"</li>
            <li><strong>Mobile Safari:</strong> Tap the share button → "Add to Home Screen"</li>
        </ul>
    </div>

    <script>
        const statusDiv = document.getElementById('status');
        const manifestStatus = document.getElementById('manifest-status');
        const swStatus = document.getElementById('sw-status');
        const installStatus = document.getElementById('install-status');
        const offlineStatus = document.getElementById('offline-status');

        function updateStatus(message, type = 'info') {
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        // Test Manifest
        fetch('/manifest.json')
            .then(response => response.json())
            .then(manifest => {
                manifestStatus.textContent = '✓ Loaded';
                manifestStatus.style.color = 'green';
                console.log('Manifest:', manifest);
            })
            .catch(error => {
                manifestStatus.textContent = '✗ Failed';
                manifestStatus.style.color = 'red';
                console.error('Manifest error:', error);
            });

        // Test Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js')
                .then(registration => {
                    swStatus.textContent = '✓ Registered';
                    swStatus.style.color = 'green';
                    console.log('SW registered:', registration);
                })
                .catch(error => {
                    swStatus.textContent = '✗ Failed';
                    swStatus.style.color = 'red';
                    console.error('SW registration failed:', error);
                });
        } else {
            swStatus.textContent = '✗ Not supported';
            swStatus.style.color = 'red';
        }

        // Test Install Prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installStatus.textContent = '✓ Available';
            installStatus.style.color = 'green';
            updateStatus('Install prompt is available! You can install this PWA.', 'success');
        });

        // Test Offline Support
        if ('serviceWorker' in navigator) {
            offlineStatus.textContent = '✓ Supported';
            offlineStatus.style.color = 'green';
        } else {
            offlineStatus.textContent = '✗ Not supported';
            offlineStatus.style.color = 'red';
        }

        // Check if already installed
        if (window.matchMedia('(display-mode: standalone)').matches) {
            updateStatus('This PWA is already installed and running in standalone mode!', 'success');
        }

        // Test offline functionality
        window.addEventListener('online', () => {
            updateStatus('Connection restored', 'info');
        });

        window.addEventListener('offline', () => {
            updateStatus('You are now offline. The app should still work with cached content.', 'info');
        });
    </script>
</body>
</html>
